<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>住宿管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h3>住宿管理</h3>
    <form id="createForm" class="row g-2 mb-3">
        <div class="col-md-3"><input id="name" class="form-control" placeholder="名稱"></div>
        <div class="col-md-3"><input id="location" class="form-control" placeholder="地點"></div>
        <div class="col-md-3"><input id="description" class="form-control" placeholder="描述"></div>
        <div class="col-md-2"><input id="price" type="number" class="form-control" placeholder="價格"></div>
        <div class="col-md-1"><button class="btn btn-primary w-100">新增</button></div>
    </form>

    <table class="table table-striped">
        <thead>
        <tr><th>ID</th><th>名稱</th><th>地點</th><th>價格</th><th></th></tr>
        </thead>
        <tbody id="accommodations"></tbody>
    </table>
</div>

<script>
    async function loadAccommodations() {
        const res = await fetch("/api/accommodations");
        const data = await res.json();
        const tbody = document.getElementById("accommodations");
        tbody.innerHTML = data.map(a => `
        <tr>
          <td>${a.id}</td>
          <td>${a.name}</td>
          <td>${a.location}</td>
          <td>${a.pricePerNight}</td>
          <td><button class="btn btn-danger btn-sm" onclick="deleteAccommodation(${a.id})">刪除</button></td>
        </tr>
    `).join('');
    }

    document.getElementById("createForm").addEventListener("submit", async e => {
        e.preventDefault();
        const acc = {
            name: name.value,
            location: location.value,
            description: description.value,
            pricePerNight: parseFloat(price.value)
        };
        await fetch("/api/admin/accommodations", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(acc)
        });
        loadAccommodations();
    });

    async function deleteAccommodation(id) {
        if (!confirm("確定刪除？")) return;
        await fetch(`/api/admin/accommodations/${id}`, {method: "DELETE"});
        loadAccommodations();
    }

    loadAccommodations();
</script>
</body>
</html>
